<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <title>Contract</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      .main-content {
        padding-top: 1rem;
      }

      .form-label {
        font-weight: bold;
      }

      .section-title {
        color: #667eea;
        border-bottom: 2px solid #667eea;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        margin-top: 1.5rem;
      }

      .form-section {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      /* Universal button styles */
      .btn {
        font-weight: 600 !important;
        border-radius: 25px !important;
        padding: 0.75rem 2rem !important;
        font-size: 1.1rem !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
        border: none !important;
      }

      .btn:hover {
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
      }

      .btn:focus,
      .btn:active {
        transform: translateY(-1px) !important;
      }

      /* Small buttons */
      .btn-sm {
        padding: 0.25rem 0.75rem !important;
        font-size: 0.8rem !important;
        border-radius: 15px !important;
      }

      /* Primary buttons */
      .btn-primary,
      .btn-nav {
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        ) !important;
        color: white !important;
      }

      .btn-primary:hover,
      .btn-nav:hover {
        background: linear-gradient(
          135deg,
          #5a6fd8 0%,
          #6b4190 100%
        ) !important;
        color: white !important;
      }

      /* Success buttons */
      .btn-success {
        background: linear-gradient(
          135deg,
          #28a745 0%,
          #20692b 100%
        ) !important;
        color: white !important;
      }

      .btn-success:hover {
        background: linear-gradient(
          135deg,
          #218838 0%,
          #1e5e26 100%
        ) !important;
        color: white !important;
      }

      /* Danger buttons */
      .btn-danger {
        background: linear-gradient(
          135deg,
          #dc3545 0%,
          #b02a37 100%
        ) !important;
        color: white !important;
      }

      .btn-danger:hover {
        background: linear-gradient(
          135deg,
          #c82333 0%,
          #9e2530 100%
        ) !important;
        color: white !important;
      }

      /* Outline buttons */
      .btn-outline-primary {
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1) 0%,
          rgba(118, 75, 162, 0.1) 100%
        ) !important;
        color: #667eea !important;
        border: 2px solid #667eea !important;
      }

      .btn-outline-primary:hover {
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        ) !important;
        color: white !important;
      }

      .btn-outline-secondary {
        background: linear-gradient(
          135deg,
          rgba(108, 117, 125, 0.1) 0%,
          rgba(73, 80, 87, 0.1) 100%
        ) !important;
        color: #6c757d !important;
        border: 2px solid #6c757d !important;
      }

      .btn-outline-secondary:hover {
        background: linear-gradient(
          135deg,
          #6c757d 0%,
          #495057 100%
        ) !important;
        color: white !important;
      }

      .btn-outline-danger {
        background: linear-gradient(
          135deg,
          rgba(220, 53, 69, 0.1) 0%,
          rgba(176, 42, 55, 0.1) 100%
        ) !important;
        color: #dc3545 !important;
        border: 2px solid #dc3545 !important;
      }

      .btn-outline-danger:hover {
        background: linear-gradient(
          135deg,
          #dc3545 0%,
          #b02a37 100%
        ) !important;
        color: white !important;
      }

      .btn-outline-success {
        background: linear-gradient(
          135deg,
          rgba(40, 167, 69, 0.1) 0%,
          rgba(32, 105, 43, 0.1) 100%
        ) !important;
        color: #28a745 !important;
        border: 2px solid #28a745 !important;
      }

      .btn-outline-success:hover {
        background: linear-gradient(
          135deg,
          #28a745 0%,
          #20692b 100%
        ) !important;
        color: white !important;
      }

      /* View mode - readonly appearance */
      .view-mode .form-control,
      .view-mode .form-select {
        background-color: #e9ecef;
        border: 1px solid #ced4da;
      }

      /* Field hint styles */
      .field-hint {
        display: block;
        font-size: 0.75rem;
        color: #6c757d;
        font-style: italic;
        font-weight: normal;
        min-height: 2.4em;
        line-height: 1.2em;
        margin-bottom: 0.25rem;
      }

      /* Required field indicator */
      .field-required {
        color: #dc3545;
        font-size: 0.75rem;
        font-style: italic;
        font-weight: normal;
      }

      /* Validation styles */
      .form-control.is-invalid {
        border-color: #dc3545;
        background-color: #fff5f5;
      }

      .form-control.is-invalid:focus {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }

      .invalid-feedback {
        display: none;
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      .form-control.is-invalid ~ .invalid-feedback {
        display: block;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <!-- Top Navigation -->
    <?!= getNavigation(activePage) ?>

    <div class="main-content container py-4">
      <h2 class="mb-4" id="page-title">Contract</h2>

      <!-- Contract Form -->
      <div id="contract-form">
        <!-- Section 1: Contract Details -->
        <h5 class="section-title">
          <i class="bi bi-file-earmark-text"></i> Contract Details
        </h5>
        <div class="form-section">
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label"
                >Our company <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <select id="ourCompany" class="form-select" required>
                <option value="">Select...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label"
                >Type of services <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <select id="serviceType" class="form-select" required>
                <option value="">Select...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label"
                >Type of cooperation <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <select id="cooperationType" class="form-select" required>
                <option value="">Select...</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label"
                >Contract's number <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <input
                type="text"
                id="contractNumber"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-4">
              <label class="form-label"
                >Contract's date <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <input
                type="date"
                id="contractDate"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">Probation period</label>
              <span class="field-hint"></span>
              <input type="date" id="probationPeriod" class="form-control" />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Termination date</label>
              <span class="field-hint"></span>
              <input type="date" id="terminationDate" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Does SOW have Start date?</label>
              <span class="field-hint"></span>
              <select id="sowStartDateRequired" class="form-select">
                <option value="">Select...</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">SOW Start date</label>
              <span class="field-hint"></span>
              <input type="date" id="sowStartDate" class="form-control" />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-12">
              <label class="form-label">Contract template</label>
              <span class="field-hint"
                >Auto-selected based on company, services, and cooperation
                type</span
              >
              <input
                type="text"
                id="contractTemplateName"
                class="form-control"
                readonly
              />
              <input type="hidden" id="contractTemplateLink" />
            </div>
          </div>
        </div>

        <!-- Section 2: Contractor Information -->
        <h5 class="section-title">
          <i class="bi bi-person-badge"></i> Contractor Information
        </h5>
        <div class="form-section">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Link to the contractor's folder</label>
              <span class="field-hint"
                >The generated contract will be saved to this folder</span
              >
              <input
                type="text"
                id="folderLink"
                class="form-control"
                placeholder="https://drive.google.com/drive/folders/..."
              />
              <div class="invalid-feedback" id="folderLink-error">
                Invalid format. Use Google Drive folder link:
                https://drive.google.com/drive/folders/...
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label"
                >Contractor's name <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"
                >For PE — the full name. For the company — the company's
                name</span
              >
              <input
                type="text"
                id="contractorName"
                class="form-control"
                required
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">PE</label>
              <span class="field-hint"
                >PE: choose language (PE/ФОП). Company: leave empty</span
              >
              <select id="pe" class="form-select">
                <option value="">Select...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label"
                >Contractor's ID <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"
                >PE: identification number. Company: company number. No number:
                "-"</span
              >
              <input
                type="text"
                id="contractorId"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-4">
              <label class="form-label"
                >Contractor's VAT ID <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint">No number: "-"</span>
              <input
                type="text"
                id="contractorVatId"
                class="form-control"
                required
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label"
                >Contractor's jurisdiction <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <input
                type="text"
                id="contractorJurisdiction"
                class="form-control"
                required
              />
            </div>
            <div class="col-md-8">
              <label class="form-label"
                >Contractor's address <span class="text-danger">*</span>
                <span class="field-required">Required</span></label
              >
              <span class="field-hint"></span>
              <input
                type="text"
                id="contractorAddress"
                class="form-control"
                required
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Registration number</label>
              <span class="field-hint">For PE contracts in Ukrainian only</span>
              <input type="text" id="registrationNumber" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Date of registration</label>
              <span class="field-hint">For PE contracts in Ukrainian only</span>
              <input type="date" id="registrationDate" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Contractor's email</label>
              <span class="field-hint"></span>
              <input type="email" id="contractorEmail" class="form-control" />
            </div>
          </div>
        </div>

        <!-- Section 3: Work Conditions -->
        <h5 class="section-title">
          <i class="bi bi-briefcase"></i> Work Conditions
        </h5>
        <div class="form-section">
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Contractor's role</label>
              <span class="field-hint"></span>
              <input type="text" id="contractorRole" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Contractor's rate</label>
              <span class="field-hint"></span>
              <input
                type="number"
                id="contractorRate"
                class="form-control"
                step="0.01"
                min="0"
              />
            </div>
            <div class="col-md-4">
              <label class="form-label">Currency of rate</label>
              <span class="field-hint"></span>
              <input
                type="text"
                id="currencyOfRate"
                class="form-control"
                placeholder="USD, EUR, UAH..."
              />
            </div>
          </div>
        </div>

        <!-- Section 4: Bank Details -->
        <h5 class="section-title"><i class="bi bi-bank"></i> Bank Details</h5>
        <div class="form-section">
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Bank account UAH</label>
              <span class="field-hint"></span>
              <input type="text" id="bankAccountUAH" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Bank account USD</label>
              <span class="field-hint"></span>
              <input type="text" id="bankAccountUSD" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Bank account EUR</label>
              <span class="field-hint"></span>
              <input type="text" id="bankAccountEUR" class="form-control" />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Bank name</label>
              <span class="field-hint"></span>
              <input type="text" id="bankName" class="form-control" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Account type</label>
              <span class="field-hint"></span>
              <select id="accountType" class="form-select">
                <option value="">Select...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Bank code</label>
              <span class="field-hint"></span>
              <input type="text" id="bankCode" class="form-control" />
            </div>
          </div>
        </div>
      </div>

      <!-- Create mode buttons -->
      <div id="create-buttons" class="row mt-4" style="display: none">
        <div class="col-md-12 d-flex justify-content-end gap-2">
          <button
            id="confirm-btn"
            class="btn btn-success"
            onclick="confirmContract()"
          >
            Confirm
          </button>
          <button
            id="cancel-btn"
            class="btn btn-outline-secondary"
            onclick="goToContractsList()"
          >
            Cancel
          </button>
        </div>
      </div>

      <!-- View mode buttons -->
      <div id="view-buttons" class="row mt-4" style="display: none">
        <div class="col-md-12 d-flex justify-content-end gap-2">
          <button
            class="btn btn-outline-secondary"
            onclick="switchToMode('edit')"
          >
            Edit
          </button>
          <button
            class="btn btn-outline-danger"
            onclick="switchToMode('delete')"
          >
            Delete
          </button>
          <button
            class="btn btn-outline-success"
            onclick="switchToMode('copy')"
          >
            Copy
          </button>
          <button class="btn btn-outline-primary" onclick="goToContractsList()">
            Cancel
          </button>
        </div>
      </div>

      <!-- Edit mode buttons -->
      <div id="edit-buttons" class="row mt-4" style="display: none">
        <div class="col-md-12 d-flex justify-content-end gap-2">
          <button class="btn btn-success" onclick="saveContract()">
            Save changes
          </button>
          <button
            class="btn btn-outline-secondary"
            onclick="switchToMode('view')"
          >
            Cancel
          </button>
        </div>
      </div>

      <!-- Delete mode buttons -->
      <div id="delete-buttons" class="row mt-4" style="display: none">
        <div class="col-md-12 d-flex justify-content-end gap-2">
          <button class="btn btn-danger" onclick="deleteContract()">
            Confirm Delete
          </button>
          <button
            class="btn btn-outline-secondary"
            onclick="switchToMode('view')"
          >
            Cancel
          </button>
        </div>
      </div>

      <!-- Copy mode buttons -->
      <div id="copy-buttons" class="row mt-4" style="display: none">
        <div class="col-md-12 d-flex justify-content-end gap-2">
          <button class="btn btn-success" onclick="copyContract()">
            Create Copy
          </button>
          <button
            class="btn btn-outline-secondary"
            onclick="switchToMode('view')"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
    <!-- Close main-content -->

    <script>
      const BASE_URL = "<?= baseUrl ?>";
      let mode = "<?= mode ?>" || "create";
      let contractId = "<?= contractId ?>";

      // Navigation
      function goToContractsList() {
        const target = BASE_URL + "?page=ContractsList";
        try {
          window.top.location.href = target;
          return;
        } catch (e) {}
        try {
          window.location.href = target;
          return;
        } catch (e2) {}
        if (
          google &&
          google.script &&
          google.script.host &&
          google.script.host.close
        ) {
          google.script.host.close();
        }
      }

      // Switch between modes
      function switchToMode(newMode) {
        if (contractId) {
          const target =
            BASE_URL +
            "?page=ContractGenerator&id=" +
            contractId +
            "&mode=" +
            newMode;
          window.location.href = target;
        } else {
          mode = newMode;
          updateUIForMode();
        }
      }

      // Set form fields readonly or editable
      function setFormReadonly(isReadonly) {
        const formEl = document.getElementById("contract-form");
        if (isReadonly) {
          formEl.classList.add("view-mode");
        } else {
          formEl.classList.remove("view-mode");
        }

        document
          .querySelectorAll("#contract-form input, #contract-form select")
          .forEach((el) => {
            el.disabled = isReadonly;
          });
      }

      // Update UI based on current mode
      function updateUIForMode() {
        const titleEl = document.getElementById("page-title");

        // Hide all button containers
        document.getElementById("create-buttons").style.display = "none";
        document.getElementById("view-buttons").style.display = "none";
        document.getElementById("edit-buttons").style.display = "none";
        document.getElementById("delete-buttons").style.display = "none";
        document.getElementById("copy-buttons").style.display = "none";

        switch (mode) {
          case "create":
            titleEl.textContent = "Create Contract";
            document.getElementById("create-buttons").style.display = "flex";
            setFormReadonly(false);
            break;
          case "view":
            titleEl.textContent = "Contract - View";
            document.getElementById("view-buttons").style.display = "flex";
            setFormReadonly(true);
            break;
          case "edit":
            titleEl.textContent = "Contract - Edit";
            document.getElementById("edit-buttons").style.display = "flex";
            setFormReadonly(false);
            break;
          case "delete":
            titleEl.textContent = "Contract - Delete";
            document.getElementById("delete-buttons").style.display = "flex";
            setFormReadonly(true);
            break;
          case "copy":
            titleEl.textContent = "Contract - Copy";
            document.getElementById("copy-buttons").style.display = "flex";
            setFormReadonly(false);
            break;
          default:
            titleEl.textContent = "Create Contract";
            document.getElementById("create-buttons").style.display = "flex";
            setFormReadonly(false);
        }
      }

      // Populate dropdown lists from Lists sheet
      function populateDropdowns() {
        google.script.run
          .withSuccessHandler(function (options) {
            // PE dropdown (column D)
            fillDropdown("pe", options.peOptions);

            // Our company dropdown (column B)
            fillDropdown("ourCompany", options.ourCompanies);

            // Type of services dropdown (column C)
            fillDropdown("serviceType", options.serviceTypes);

            // Type of cooperation dropdown (column A)
            fillDropdown("cooperationType", options.cooperationTypes);

            // Account type dropdown (column E)
            fillDropdown("accountType", options.accountTypes);
          })
          .withFailureHandler(function (error) {
            console.error("Error loading dropdown options:", error);
          })
          .getContractDropdownOptions();
      }

      function fillDropdown(elementId, options) {
        const select = document.getElementById(elementId);
        if (!select) return;

        // Clear existing options except first
        while (select.options.length > 1) {
          select.remove(1);
        }

        // Add new options
        if (options && options.length > 0) {
          options.forEach((opt) => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            select.appendChild(option);
          });
        }
      }

      // Load contract templates based on selected criteria
      function loadContractTemplates() {
        const cooperationType =
          document.getElementById("cooperationType").value;
        const ourCompany = document.getElementById("ourCompany").value;
        const serviceType = document.getElementById("serviceType").value;

        const nameField = document.getElementById("contractTemplateName");
        const linkField = document.getElementById("contractTemplateLink");

        // Clear if not all fields are selected
        if (!cooperationType || !ourCompany || !serviceType) {
          nameField.value = "";
          linkField.value = "";
          return;
        }

        google.script.run
          .withSuccessHandler(function (templates) {
            if (templates && templates.length > 0) {
              // Use first matching template
              nameField.value = templates[0].name;
              linkField.value = templates[0].link;
            } else {
              nameField.value = "No template found";
              linkField.value = "";
            }
          })
          .withFailureHandler(function (error) {
            console.error("Error loading templates:", error);
            nameField.value = "Error loading template";
            linkField.value = "";
          })
          .getContractTemplates(cooperationType, ourCompany, serviceType);
      }

      // Action handlers (stubs for now)
      function confirmContract() {
        alert("Contract creation - coming soon!");
      }

      function saveContract() {
        alert("Save changes - coming soon!");
      }

      function deleteContract() {
        alert("Delete contract - coming soon!");
      }

      function copyContract() {
        alert("Copy contract - coming soon!");
      }

      // Validate Google Drive folder link
      function validateFolderLink() {
        const input = document.getElementById("folderLink");
        const value = input.value.trim();

        // Empty is allowed (field is optional)
        if (!value) {
          input.classList.remove("is-invalid");
          return true;
        }

        // Check for Google Drive folder link pattern
        const drivePattern =
          /^https:\/\/drive\.google\.com\/(drive\/folders\/|open\?id=|file\/d\/|folders\/)/i;

        if (drivePattern.test(value)) {
          input.classList.remove("is-invalid");
          return true;
        } else {
          input.classList.add("is-invalid");
          return false;
        }
      }

      // Initialize on page load
      window.addEventListener("DOMContentLoaded", function () {
        populateDropdowns();
        updateUIForMode();

        // Add folder link validation on input
        const folderLinkInput = document.getElementById("folderLink");
        folderLinkInput.addEventListener("input", validateFolderLink);
        folderLinkInput.addEventListener("blur", validateFolderLink);

        // Add listeners for template auto-loading
        ["cooperationType", "ourCompany", "serviceType"].forEach((id) => {
          const el = document.getElementById(id);
          if (el) {
            el.addEventListener("change", loadContractTemplates);
          }
        });

        // If viewing/editing existing contract, load its data
        if (contractId && mode !== "create") {
          google.script.run
            .withSuccessHandler(fillContractForm)
            .withFailureHandler(function (error) {
              console.error("Error loading contract:", error);
              alert("Failed to load contract data");
            })
            .getContractDataById(contractId);
        }
      });

      // Fill form with contract data
      function fillContractForm(data) {
        if (!data) {
          console.log("No contract data received");
          return;
        }

        // Set text/url/email fields
        document.getElementById("folderLink").value = data.folderLink || "";
        document.getElementById("contractorName").value =
          data.contractorName || "";
        document.getElementById("contractorId").value = data.contractorId || "";
        document.getElementById("contractorVatId").value =
          data.contractorVatId || "";
        document.getElementById("contractorJurisdiction").value =
          data.contractorJurisdiction || "";
        document.getElementById("contractorAddress").value =
          data.contractorAddress || "";
        document.getElementById("registrationNumber").value =
          data.registrationNumber || "";
        document.getElementById("contractorEmail").value =
          data.contractorEmail || "";
        document.getElementById("contractNumber").value =
          data.contractNumber || "";
        document.getElementById("contractorRole").value =
          data.contractorRole || "";
        document.getElementById("contractorRate").value =
          data.contractorRate || "";
        document.getElementById("currencyOfRate").value =
          data.currencyOfRate || "";
        document.getElementById("bankAccountUAH").value =
          data.bankAccountUAH || "";
        document.getElementById("bankAccountUSD").value =
          data.bankAccountUSD || "";
        document.getElementById("bankAccountEUR").value =
          data.bankAccountEUR || "";
        document.getElementById("bankName").value = data.bankName || "";
        document.getElementById("bankCode").value = data.bankCode || "";

        // Set date fields
        document.getElementById("registrationDate").value =
          data.registrationDate || "";
        document.getElementById("contractDate").value = data.contractDate || "";
        document.getElementById("probationPeriod").value =
          data.probationPeriod || "";
        document.getElementById("terminationDate").value =
          data.terminationDate || "";
        document.getElementById("sowStartDate").value = data.sowStartDate || "";

        // Set select fields (after dropdowns are populated)
        setTimeout(function () {
          document.getElementById("pe").value = data.pe || "";
          document.getElementById("ourCompany").value = data.ourCompany || "";
          document.getElementById("serviceType").value = data.serviceType || "";
          document.getElementById("cooperationType").value =
            data.cooperationType || "";
          document.getElementById("accountType").value = data.accountType || "";
          document.getElementById("sowStartDateRequired").value =
            data.sowStartDateRequired || "";

          // Load templates after setting dropdowns
          loadContractTemplates();

          // Template will be auto-loaded based on selected values
          // If contract has saved template info, show it
          setTimeout(function () {
            if (data.contractTemplateName) {
              document.getElementById("contractTemplateName").value =
                data.contractTemplateName || "";
              document.getElementById("contractTemplateLink").value =
                data.contractTemplateLink || "";
            }
          }, 500);
        }, 300);
      }
    </script>
  </body>
</html>
